<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi, Laporan Harian dan KPI Kantor Pusat</title>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.9/dist/cdn.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #3B82F6;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #2563EB;
        }

        /* Dark mode styles */
        .dark {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #4a5568 100%);
        }

        .dark .bg-white {
            background-color: #2d3748 !important;
        }

        .dark .bg-gray-50 {
            background-color: #374151 !important;
        }

        .dark .text-gray-900 {
            color: #f7fafc !important;
        }

        .dark .text-gray-600 {
            color: #cbd5e0 !important;
        }

        .dark .border-gray-200 {
            border-color: #4a5568 !important;
        }

        /* KPI Status colors */
        .kpi-pending {
            background-color: #FEF3C7 !important;
            color: #92400E !important;
        }
        .dark .kpi-pending {
            background-color: #78350F !important;
            color: #FDE68A !important;
        }
        .kpi-in-progress {
            background-color: #DBEAFE !important;
            color: #1E40AF !important;
        }
        .dark .kpi-in-progress {
            background-color: #1E3A8A !important;
            color: #BFDBFE !important;
        }
        .kpi-completed {
            background-color: #D1FAE5 !important;
            color: #065F46 !important;
        }
        .dark .kpi-completed {
            background-color: #064E3B !important;
            color: #A7F3D0 !important;
        }
        .kpi-overdue {
            background-color: #FECACA !important;
            color: #991B1B !important;
        }
        .dark .kpi-overdue {
            background-color: #7F1D1D !important;
            color: #FCA5A5 !important;
        }

        /* Attendance status colors */
        .att-on-time {
            background-color: #D1FAE5 !important;
            color: #065F46 !important;
        }
        .dark .att-on-time {
            background-color: #064E3B !important;
            color: #A7F3D0 !important;
        }
        .att-late {
            background-color: #FFEDD5 !important;
            color: #9A3412 !important;
        }
        .dark .att-late {
            background-color: #7C2D12 !important;
            color: #FCD34D !important;
        }
        .att-sick {
            background-color: #FEF3C7 !important;
            color: #92400E !important;
        }
        .dark .att-sick {
            background-color: #78350F !important;
            color: #FDE68A !important;
        }
        .att-permit {
            background-color: #DBEAFE !important;
            color: #1E40AF !important;
        }
        .dark .att-permit {
            background-color: #1E3A8A !important;
            color: #BFDBFE !important;
        }
        .att-field-duty {
            background-color: #E0E7FF !important;
            color: #5B21B6 !important;
        }
        .dark .att-field-duty {
            background-color: #4C1D95 !important;
            color: #C4B5FD !important;
        }
        .att-absent {
            background-color: #FECACA !important;
            color: #991B1B !important;
        }
        .dark .att-absent {
            background-color: #7F1D1D !important;
            color: #FCA5A5 !important;
        }

        /* Modal overlay */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>

    <script>
        // Tailwind configuration
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3B82F6',
                            600: '#2563EB',
                            700: '#1d4ed8'
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-700 transition-colors duration-300" 
      x-data="kpiApp()" 
      x-init="init()" 
      :class="{ 'dark': darkMode }">

    <!-- Loading Screen -->
    <div x-show="loading" 
         class="fixed inset-0 bg-gradient-to-br from-primary-500 to-blue-600 flex items-center justify-center z-50">
        <div class="text-center text-white">
            <div class="animate-spin rounded-full h-16 w-16 border-4 border-white border-t-transparent mb-4 mx-auto"></div>
            <h2 class="text-2xl font-bold mb-2">Ibnu Katsir Indonesia</h2>
            <p class="text-lg opacity-90">Bismillah...</p>
            <div x-show="supabaseConnected" class="mt-2 text-sm opacity-75">
                <i class="fas fa-database mr-1"></i>Database Connected
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="fixed top-4 right-4 z-40 space-y-2" x-show="notifications.length > 0">
        <template x-for="notification in notifications" :key="notification.id">
            <div x-show="notification.show"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-x-2"
                 x-transition:enter-end="opacity-100 transform translate-x-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 transform translate-x-0"
                 x-transition:leave-end="opacity-0 transform translate-x-2"
                 class="max-w-sm rounded-lg shadow-lg p-4 pointer-events-auto"
                 :class="{
                     'bg-green-500 text-white': notification.type === 'success',
                     'bg-red-500 text-white': notification.type === 'error',
                     'bg-blue-500 text-white': notification.type === 'info',
                     'bg-yellow-500 text-white': notification.type === 'warning'
                 }">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i :class="{
                            'fas fa-check-circle': notification.type === 'success',
                            'fas fa-exclamation-circle': notification.type === 'error',
                            'fas fa-info-circle': notification.type === 'info',
                            'fas fa-exclamation-triangle': notification.type === 'warning'
                        }" class="mr-2"></i>
                        <span x-text="notification.message"></span>
                    </div>
                    <button @click="removeNotification(notification.id)" class="ml-2 hover:opacity-75">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </template>
    </div>

    <!-- Employee Management Modal -->
    <div x-show="showEmployeeModal" 
         class="fixed inset-0 z-50 overflow-y-auto modal-overlay"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" @click="closeEmployeeModal()"></div>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">
                
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-user-plus mr-2 text-primary-500"></i>
                                <span x-text="editingEmployee ? 'Edit Pegawai' : 'Tambah Pegawai Baru'"></span>
                            </h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Nama Lengkap <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="employeeForm.name"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                           placeholder="Masukkan nama lengkap">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Username <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="employeeForm.username"
                                           :disabled="editingEmployee"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed"
                                           placeholder="Masukkan username">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Email <span class="text-red-500">*</span>
                                    </label>
                                    <input type="email" 
                                           x-model="employeeForm.email"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                           placeholder="Masukkan email">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Password <span class="text-red-500">*</span>
                                    </label>
                                    <div class="relative">
                                        <input :type="showEmployeePassword ? 'text' : 'password'" 
                                               x-model="employeeForm.password"
                                               class="w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                               :placeholder="editingEmployee ? 'Kosongkan jika tidak ingin mengubah password' : 'Masukkan password'">
                                        <button type="button" 
                                                @click="showEmployeePassword = !showEmployeePassword"
                                                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300">
                                            <i :class="showEmployeePassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Posisi/Jabatan
                                    </label>
                                    <input type="text" 
                                           x-model="employeeForm.position"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                           placeholder="Masukkan posisi/jabatan">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Status
                                    </label>
                                    <select x-model="employeeForm.status"
                                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                        <option value="active">Aktif</option>
                                        <option value="inactive">Tidak Aktif</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="saveEmployee()" 
                            :disabled="isSubmitting || !isEmployeeFormValid()"
                            :class="isSubmitting || !isEmployeeFormValid() ? 'opacity-50 cursor-not-allowed' : 'hover:bg-primary-700'"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-show="!isSubmitting">
                            <i class="fas fa-save mr-2"></i>
                            <span x-text="editingEmployee ? 'Update' : 'Simpan'"></span>
                        </span>
                        <span x-show="isSubmitting" class="flex items-center">
                            <div class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"></div>
                            <span x-text="editingEmployee ? 'Mengupdate...' : 'Menyimpan...'"></span>
                        </span>
                    </button>
                    
                    <button @click="closeEmployeeModal()" 
                            type="button"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-times mr-2"></i>Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Backup Controls (Admin Only) -->
    <div x-show="isLoggedIn && isAdmin" class="fixed bottom-4 right-4 z-30 space-y-2">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 border border-gray-200 dark:border-gray-700">
            <h5 class="text-sm font-semibold text-gray-900 dark:text-white mb-2">
                <i class="fas fa-database mr-1"></i>Data Management
            </h5>
            <div class="flex flex-col space-y-2">
                <div class="text-xs text-gray-500 dark:text-gray-400" x-show="supabaseConnected">
                    <i class="fas fa-check-circle text-green-500 mr-1"></i>Supabase Connected
                </div>
                <div class="flex space-x-2">
                    <button @click="exportData()" 
                            class="px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded text-xs font-medium transition-colors">
                        <i class="fas fa-download mr-1"></i>Export
                    </button>
                    <label class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-xs font-medium transition-colors cursor-pointer">
                        <i class="fas fa-upload mr-1"></i>Import
                        <input type="file" @change="importData($event)" accept=".json" class="hidden">
                    </label>
                </div>
                <button @click="syncToSupabase()" 
                        :disabled="!supabaseConnected || isSyncing"
                        :class="!supabaseConnected || isSyncing ? 'opacity-50 cursor-not-allowed' : 'hover:bg-purple-600'"
                        class="px-3 py-1 bg-purple-500 text-white rounded text-xs font-medium transition-colors">
                    <i :class="isSyncing ? 'fas fa-sync-alt animate-spin' : 'fas fa-cloud-upload-alt'" class="mr-1"></i>
                    <span x-text="isSyncing ? 'Syncing...' : 'Sync to DB'"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        
        <!-- Login Screen -->
        <div x-show="!isLoggedIn" 
             class="min-h-screen flex items-center justify-center">
            
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md">
                <!-- Dark Mode Toggle -->
                <div class="flex justify-end mb-4">
                    <button @click="toggleDarkMode()" 
                            class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                        <i x-show="!darkMode" class="fas fa-moon"></i>
                        <i x-show="darkMode" class="fas fa-sun"></i>
                    </button>
                </div>

                <div class="text-center mb-8">
                    <div class="mx-auto w-16 h-16 bg-gradient-to-br from-primary-500 to-blue-600 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-chart-line text-2xl text-white"></i>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Absensi, Laporan Harian dan KPI Kantor Pusat</h1>
                    <p class="text-gray-600 dark:text-gray-400">Menjadi Yayasan Pendidikan, Dakwah, dan Sosial terkemuka di Indonesia, yang fokus pada penyelenggaraan Lembaga Pendidikan Islami berbasis Al Qur'an</p>
                </div>

                <!-- Login Form -->
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            <i class="fas fa-user mr-2"></i>Username
                        </label>
                        <input type="text" 
                               x-model="credentials.username"
                               @keyup.enter="login()"
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-all duration-200"
                               placeholder="Masukkan username">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            <i class="fas fa-lock mr-2"></i>Password
                        </label>
                        <div class="relative">
                            <input :type="showPassword ? 'text' : 'password'" 
                                   x-model="credentials.password"
                                   @keyup.enter="login()"
                                   class="w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-all duration-200"
                                   placeholder="Masukkan password">
                            <button type="button" 
                                    @click="showPassword = !showPassword"
                                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300">
                                <i :class="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <button @click="login()" 
                        :disabled="!credentials.username || !credentials.password || isLoggingIn"
                        :class="!credentials.username || !credentials.password || isLoggingIn ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                        class="w-full bg-gradient-to-r from-primary-500 to-blue-600 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-200">
                    <span x-show="!isLoggingIn">
                        <i class="fas fa-sign-in-alt mr-2"></i>Masuk
                    </span>
                    <span x-show="isLoggingIn" class="flex items-center justify-center">
                        <div class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"></div>
                        Masuk...
                    </span>
                </button>
            </div>
        </div>

        <!-- Main Application -->
        <div x-show="isLoggedIn" class="space-y-6">

            <!-- Header -->
            <div class="bg-gradient-to-r from-primary-500 to-blue-600 rounded-2xl shadow-xl p-6 text-white">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                    <div>
                        <h1 class="text-2xl lg:text-3xl font-bold mb-2">
                            <i class="fas fa-chart-line mr-3"></i>KPI Tracker & Daily Report
                        </h1>
                        <p class="text-lg opacity-90" x-text="isAdmin ? 'Panel Administrator' : `Selamat datang, ${currentUser.name}`"></p>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
                        <!-- Real-time Clock -->
                        <div class="bg-white/20 backdrop-blur-sm rounded-xl px-4 py-2 text-center">
                            <div class="text-sm opacity-75">Waktu Jakarta</div>
                            <div class="font-bold text-lg" x-text="currentTime"></div>
                        </div>
                        
                        <!-- Today's KPI Status (for employees) -->
                        <template x-if="!isAdmin">
                            <div class="bg-white/20 backdrop-blur-sm rounded-xl px-4 py-2 text-center">
                                <div class="text-sm opacity-75">KPI Progress</div>
                                <div class="font-bold text-sm" x-text="getKPIProgress() + '% Complete'"></div>
                            </div>
                        </template>

                        <!-- Today's Attendance Status (for employees) -->
                        <template x-if="!isAdmin">
                            <div class="bg-white/20 backdrop-blur-sm rounded-xl px-4 py-2 text-center">
                                <div class="text-sm opacity-75">Status Absensi</div>
                                <div class="font-bold text-sm" x-text="getTodayAttendanceStatus()"></div>
                            </div>
                        </template>

                        <!-- Dark Mode Toggle -->
                        <button @click="toggleDarkMode()" 
                                class="p-2 rounded-lg bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-colors">
                            <i x-show="!darkMode" class="fas fa-moon"></i>
                            <i x-show="darkMode" class="fas fa-sun"></i>
                        </button>

                        <!-- Logout Button -->
                        <button @click="logout()" 
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center space-x-2">
                            <i class="fas fa-sign-out-alt"></i>
                            <span class="hidden sm:inline">Logout</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-2">
                <nav class="flex flex-wrap gap-2">
                    <template x-if="isAdmin">
                        <div class="flex flex-wrap gap-2 w-full">
                            <button @click="activeTab = 'employee-management'" 
                                    :class="activeTab === 'employee-management' ? 'bg-primary-500 text-white shadow-md' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'"
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                <i class="fas fa-users"></i>
                                <span>Kelola Pegawai</span>
                            </button>

                            <button @click="activeTab = 'kpi-management'" 
                                    :class="activeTab === 'kpi-management' ? 'bg-primary-500 text-white shadow-md' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'"
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                <i class="fas fa-tasks"></i>
                                <span>Kelola KPI</span>
                            </button>
                            
                            <button @click="activeTab = 'daily-reports'" 
                                    :class="activeTab === 'daily-reports' ? 'bg-primary-500 text-white shadow-md' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'"
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                <i class="fas fa-clipboard-list"></i>
                                <span>Laporan Harian</span>
                            </button>
                            
                            <button @click="activeTab = 'kpi-recap'" 
                                    :class="activeTab === 'kpi-recap' ? 'bg-primary-500 text-white shadow-md' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'"
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                <i class="fas fa-chart-bar"></i>
                                <span>Rekap KPI</span>
                            </button>

                            <button @click="activeTab = 'attendance-recap'" 
                                    :class="activeTab === 'attendance-recap' ? 'bg-primary-500 text-white shadow-md' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'"
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                <i class="fas fa-user-clock"></i>
                                <span>Rekap Absensi</span>
                            </button>

                            <button @click="activeTab = 'monthly-report'" 
                                    :class="activeTab === 'monthly-report' ? 'bg-primary-500 text-white shadow-md' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'"
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                <i class="fas fa-file-export"></i>
                                <span>Laporan Bulanan</span>
                            </button>
                        </div>
                    </template>
                    
                    <template x-if="!isAdmin">
                        <div class="flex flex-wrap gap-2 w-full">
                            <button @click="activeTab = 'my-kpi'" 
                                    :class="activeTab === 'my-kpi' ? 'bg-primary-500 text-white shadow-md' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'"
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                <i class="fas fa-bullseye"></i>
                                <span>KPI Saya</span>
                            </button>
                            
                            <button @click="activeTab = 'attendance'" 
                                    :class="activeTab === 'attendance' ? 'bg-primary-500 text-white shadow-md' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'"
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                <i class="fas fa-clock"></i>
                                <span>Absensi</span>
                            </button>
                            
                            <button @click="activeTab = 'office-status'" 
                                    :class="activeTab === 'office-status' ? 'bg-primary-500 text-white shadow-md' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'"
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                <i class="fas fa-building"></i>
                                <span>Status Kantor</span>
                            </button>
                            
                            <button @click="activeTab = 'daily-report'" 
                                    :class="activeTab === 'daily-report' ? 'bg-primary-500 text-white shadow-md' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'"
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                <i class="fas fa-edit"></i>
                                <span>Laporan Harian</span>
                            </button>
                        </div>
                    </template>
                </nav>
            </div>

            <!-- Content -->
            <div>
                
                <!-- Admin Employee Management -->
                <template x-if="isAdmin && activeTab === 'employee-management'">
                    <div class="space-y-6">
                        <!-- Employee Management Header -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                                    <i class="fas fa-users mr-2 text-primary-500"></i>Manajemen Pegawai
                                </h3>
                                <button @click="openEmployeeModal()" 
                                        class="px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg font-medium transition-colors flex items-center space-x-2">
                                    <i class="fas fa-user-plus"></i>
                                    <span>Tambah Pegawai</span>
                                </button>
                            </div>

                            <!-- Employee Stats -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" x-text="getActiveEmployeesCount()"></div>
                                    <div class="text-sm text-blue-600 dark:text-blue-400">Pegawai Aktif</div>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="getTodayPresentCount()"></div>
                                    <div class="text-sm text-green-600 dark:text-green-400">Hadir Hari Ini</div>
                                </div>
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400" x-text="getPendingKPICount()"></div>
                                    <div class="text-sm text-yellow-600 dark:text-yellow-400">KPI Pending</div>
                                </div>
                            </div>
                        </div>

                        <!-- Employee List -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden">
                            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Daftar Pegawai</h4>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pegawai</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Username</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Email</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Posisi</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <template x-for="employee in employees.filter(emp => emp.username !== 'admin')" :key="employee.username">
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="w-10 h-10 bg-primary-500 text-white rounded-full flex items-center justify-center font-semibold text-sm mr-3"
                                                             x-text="employee.name.charAt(0).toUpperCase()"></div>
                                                        <div>
                                                            <div class="font-medium text-gray-900 dark:text-white" x-text="employee.name"></div>
                                                            <div class="text-sm text-gray-500 dark:text-gray-400" x-text="'Bergabung: ' + formatDate(employee.created_at || '2025-01-01')"></div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="employee.username"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="employee.email || '-'"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="employee.position || '-'"></td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span :class="(employee.status || 'active') === 'active' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'"
                                                          class="px-2 py-1 text-xs font-medium rounded-full">
                                                        <span x-text="(employee.status || 'active') === 'active' ? 'Aktif' : 'Tidak Aktif'"></span>
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                    <button @click="editEmployee(employee)" 
                                                            class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button @click="toggleEmployeeStatus(employee)" 
                                                            :class="(employee.status || 'active') === 'active' ? 'text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300' : 'text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300'">
                                                        <i :class="(employee.status || 'active') === 'active' ? 'fas fa-user-times' : 'fas fa-user-check'"></i>
                                                    </button>
                                                    <button @click="resetEmployeePassword(employee)" 
                                                            class="text-yellow-600 hover:text-yellow-900 dark:text-yellow-400 dark:hover:text-yellow-300">
                                                        <i class="fas fa-key"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Employee KPI Dashboard -->
                <template x-if="!isAdmin && activeTab === 'my-kpi'">
                    <div class="space-y-6">
                        <!-- KPI Summary Card -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
                                    <i class="fas fa-bullseye mr-3 text-primary-500"></i>
                                    KPI Saya
                                </h2>
                                <div class="text-right">
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Progress Keseluruhan</div>
                                    <div class="text-3xl font-bold text-primary-500" x-text="getKPIProgress() + '%'"></div>
                                </div>
                            </div>
                            
                            <!-- Progress Bar -->
                            <div class="mb-6">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Completed</span>
                                    <span class="text-sm text-gray-600 dark:text-gray-400" x-text="getCompletedKPICount() + ' dari ' + getMyKPIs().length + ' KPI'"></span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                                    <div class="bg-gradient-to-r from-green-500 to-green-600 h-3 rounded-full transition-all duration-500" 
                                         :style="`width: ${getKPIProgress()}%`"></div>
                                </div>
                            </div>
                        </div>

                        <!-- KPI List -->
                        <div class="space-y-4">
                            <template x-for="kpi in getMyKPIs()" :key="kpi.id">
                                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border-l-4"
                                     :class="{
                                         'border-green-500': kpi.status === 'completed',
                                         'border-blue-500': kpi.status === 'in-progress',
                                         'border-yellow-500': kpi.status === 'pending',
                                         'border-red-500': kpi.status === 'overdue'
                                     }">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center space-x-3 mb-2">
                                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="kpi.title"></h3>
                                                <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                      :class="{
                                                          'kpi-completed': kpi.status === 'completed',
                                                          'kpi-in-progress': kpi.status === 'in-progress',
                                                          'kpi-pending': kpi.status === 'pending',
                                                          'kpi-overdue': kpi.status === 'overdue'
                                                      }"
                                                      x-text="getKPIStatusLabel(kpi.status)"></span>
                                            </div>
                                            <p class="text-gray-600 dark:text-gray-400 mb-3" x-text="kpi.description"></p>
                                            <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                                                <div>
                                                    <i class="fas fa-calendar mr-1"></i>
                                                    Deadline: <span x-text="formatDate(kpi.deadline)"></span>
                                                </div>
                                                <div>
                                                    <i class="fas fa-user mr-1"></i>
                                                    Dibuat: <span x-text="formatDate(kpi.createdAt)"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ml-4">
                                            <button @click="toggleKPIStatus(kpi.id)" 
                                                    :class="kpi.status === 'completed' ? 'bg-green-500 hover:bg-green-600' : 'bg-blue-500 hover:bg-blue-600'"
                                                    class="px-4 py-2 text-white rounded-lg font-medium transition-colors flex items-center space-x-2">
                                                <i :class="kpi.status === 'completed' ? 'fas fa-check' : 'fas fa-play'"></i>
                                                <span x-text="kpi.status === 'completed' ? 'Selesai' : 'Mulai'"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <!-- Empty State -->
                            <template x-if="getMyKPIs().length === 0">
                                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-12 text-center">
                                    <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-clipboard-list text-2xl text-gray-400"></i>
                                    </div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Belum Ada KPI</h3>
                                    <p class="text-gray-600 dark:text-gray-400">Admin belum menetapkan KPI untuk Anda.</p>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>

                <!-- Employee Attendance -->
                <template x-if="!isAdmin && activeTab === 'attendance'">
                    <div class="space-y-6">
                        <!-- Today's Attendance Form -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                                <i class="fas fa-clock mr-3 text-primary-500"></i>
                                Absensi Hari Ini - <span x-text="getCurrentDateString()"></span>
                            </h2>
                            
                            <!-- Check if already submitted today -->
                            <template x-if="getTodayAttendance()">
                                <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6 mb-6">
                                    <div class="flex items-center space-x-3 mb-4">
                                        <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                                            <i class="fas fa-check text-white text-xl"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-semibold text-green-800 dark:text-green-200">Absensi Hari Ini Sudah Tercatat</h3>
                                            <p class="text-green-600 dark:text-green-300">
                                                Status: <span x-text="getAttendanceStatusLabel(getTodayAttendance().status)"></span> | 
                                                Waktu: <span x-text="formatDateTime(getTodayAttendance().timestamp)"></span>
                                            </p>
                                            <template x-if="getTodayAttendance().description">
                                                <p class="text-green-600 dark:text-green-300 mt-1">
                                                    Keterangan: <span x-text="getTodayAttendance().description"></span>
                                                </p>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Attendance Form -->
                            <template x-if="!getTodayAttendance()">
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                                            <i class="fas fa-user-check mr-2"></i>Status Absensi
                                        </label>
                                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                                            <button @click="attendanceForm.status = 'on-time'" 
                                                    :class="attendanceForm.status === 'on-time' ? 'bg-green-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                                                    class="p-3 rounded-lg font-medium transition-colors flex flex-col items-center space-y-1">
                                                <i class="fas fa-check-circle text-lg"></i>
                                                <span class="text-sm">Tepat Waktu</span>
                                            </button>
                                            <button @click="attendanceForm.status = 'late'" 
                                                    :class="attendanceForm.status === 'late' ? 'bg-orange-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                                                    class="p-3 rounded-lg font-medium transition-colors flex flex-col items-center space-y-1">
                                                <i class="fas fa-clock text-lg"></i>
                                                <span class="text-sm">Terlambat</span>
                                            </button>
                                            <button @click="attendanceForm.status = 'field-duty'" 
                                                    :class="attendanceForm.status === 'field-duty' ? 'bg-purple-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                                                    class="p-3 rounded-lg font-medium transition-colors flex flex-col items-center space-y-1">
                                                <i class="fas fa-road text-lg"></i>
                                                <span class="text-sm">Tugas Luar</span>
                                            </button>
                                            <button @click="attendanceForm.status = 'sick'" 
                                                    :class="attendanceForm.status === 'sick' ? 'bg-yellow-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                                                    class="p-3 rounded-lg font-medium transition-colors flex flex-col items-center space-y-1">
                                                <i class="fas fa-thermometer-half text-lg"></i>
                                                <span class="text-sm">Sakit</span>
                                            </button>
                                            <button @click="attendanceForm.status = 'permit'" 
                                                    :class="attendanceForm.status === 'permit' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                                                    class="p-3 rounded-lg font-medium transition-colors flex flex-col items-center space-y-1">
                                                <i class="fas fa-hand-paper text-lg"></i>
                                                <span class="text-sm">Izin</span>
                                            </button>
                                        </div>
                                    </div>

                                    <template x-if="attendanceForm.status && needsDescription()">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                                                <i class="fas fa-comment mr-2"></i>Keterangan/Alasan
                                            </label>
                                            <textarea x-model="attendanceForm.description"
                                                      class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none"
                                                      rows="3"
                                                      :placeholder="getDescriptionPlaceholder(attendanceForm.status)"></textarea>
                                        </div>
                                    </template>

                                    <div class="flex space-x-3">
                                        <button @click="submitAttendance()" 
                                                :disabled="!attendanceForm.status || (needsDescription() && !attendanceForm.description.trim()) || isSubmitting"
                                                :class="!attendanceForm.status || (needsDescription() && !attendanceForm.description.trim()) || isSubmitting ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                                                class="flex-1 bg-gradient-to-r from-primary-500 to-blue-600 text-white py-3 px-6 rounded-lg font-semibold transition-all duration-200">
                                            <span x-show="!isSubmitting">
                                                <i class="fas fa-user-check mr-2"></i>Submit Absensi
                                            </span>
                                            <span x-show="isSubmitting" class="flex items-center justify-center">
                                                <div class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"></div>
                                                Menyimpan...
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- Attendance History -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-history mr-2 text-primary-500"></i>Riwayat Absensi
                            </h3>
                            
                            <div class="space-y-4">
                                <template x-for="attendance in getMyAttendanceHistory().slice(0, 10)" :key="attendance.date">
                                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <h4 class="font-semibold text-gray-900 dark:text-white" x-text="formatDate(attendance.date)"></h4>
                                            <div class="flex items-center space-x-3">
                                                <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                      :class="{
                                                          'att-on-time': attendance.status === 'on-time',
                                                          'att-late': attendance.status === 'late',
                                                          'att-field-duty': attendance.status === 'field-duty',
                                                          'att-sick': attendance.status === 'sick',
                                                          'att-permit': attendance.status === 'permit'
                                                      }"
                                                      x-text="getAttendanceStatusLabel(attendance.status)"></span>
                                                <span class="text-sm text-gray-500 dark:text-gray-400" x-text="formatDateTime(attendance.timestamp)"></span>
                                            </div>
                                        </div>
                                        <template x-if="attendance.description">
                                            <p class="text-sm text-gray-600 dark:text-gray-400" x-text="attendance.description"></p>
                                        </template>
                                    </div>
                                </template>
                                
                                <!-- Empty State -->
                                <template x-if="getMyAttendanceHistory().length === 0">
                                    <div class="text-center py-8">
                                        <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <i class="fas fa-user-clock text-2xl text-gray-400"></i>
                                        </div>
                                        <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Belum Ada Absensi</h4>
                                        <p class="text-gray-600 dark:text-gray-400">Mulai catat absensi harian Anda.</p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Office Status Tab -->
                <template x-if="!isAdmin && activeTab === 'office-status'">
                    <div class="space-y-6">
                        <!-- Status Kantor Header -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                                <i class="fas fa-building mr-3 text-primary-500"></i>
                                Status Kantor Hari Ini - <span x-text="getCurrentDateString()"></span>
                            </h2>
                            
                            <!-- Summary Stats -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="getTodayOfficeStats().present"></div>
                                    <div class="text-sm text-green-600 dark:text-green-400">Hadir</div>
                                </div>
                                <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" x-text="getTodayOfficeStats().fieldDuty"></div>
                                    <div class="text-sm text-purple-600 dark:text-purple-400">Tugas Luar</div>
                                </div>
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400" x-text="getTodayOfficeStats().sick"></div>
                                    <div class="text-sm text-yellow-600 dark:text-yellow-400">Sakit</div>
                                </div>
                                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" x-text="getTodayOfficeStats().permit"></div>
                                    <div class="text-sm text-blue-600 dark:text-blue-400">Izin</div>
                                </div>
                            </div>
                        </div>

                        <!-- Employee Status List -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-users mr-2 text-primary-500"></i>Status Pegawai
                            </h3>
                            
                            <div class="space-y-3">
                                <template x-for="employee in employees.filter(emp => emp.username !== 'admin' && (emp.status || 'active') === 'active')" :key="employee.username">
                                    <div class="flex items-center justify-between p-4 border border-gray-200 dark:border-gray-700 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-primary-500 text-white rounded-full flex items-center justify-center font-semibold"
                                                 x-text="employee.name.charAt(0).toUpperCase()"></div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900 dark:text-white" x-text="employee.name"></h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400" x-text="getEmployeeTodayAttendance(employee.username)?.timestamp ? formatDateTime(getEmployeeTodayAttendance(employee.username).timestamp) : 'Belum absen'"></p>
                                            </div>
                                        </div>
                                        
                                        <div class="text-right">
                                            <template x-if="getEmployeeTodayAttendance(employee.username)">
                                                <div>
                                                    <span class="px-3 py-1 text-sm font-medium rounded-full"
                                                          :class="{
                                                              'att-on-time': getEmployeeTodayAttendance(employee.username).status === 'on-time',
                                                              'att-late': getEmployeeTodayAttendance(employee.username).status === 'late',
                                                              'att-field-duty': getEmployeeTodayAttendance(employee.username).status === 'field-duty',
                                                              'att-sick': getEmployeeTodayAttendance(employee.username).status === 'sick',
                                                              'att-permit': getEmployeeTodayAttendance(employee.username).status === 'permit'
                                                          }"
                                                          x-text="getAttendanceStatusLabel(getEmployeeTodayAttendance(employee.username).status)"></span>
                                                    <template x-if="getEmployeeTodayAttendance(employee.username).description">
                                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" x-text="getEmployeeTodayAttendance(employee.username).description"></p>
                                                    </template>
                                                </div>
                                            </template>
                                            <template x-if="!getEmployeeTodayAttendance(employee.username)">
                                                <span class="px-3 py-1 text-sm font-medium rounded-full bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400">
                                                    Belum Absen
                                                </span>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Employee Daily Report -->
                <template x-if="!isAdmin && activeTab === 'daily-report'">
                    <div class="space-y-6">
                        <!-- Today's Report Form -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                                <i class="fas fa-edit mr-3 text-primary-500"></i>
                                Laporan Harian - <span x-text="getCurrentDateString()"></span>
                            </h2>
                            
                            <!-- Check if already submitted today -->
                            <template x-if="getTodayReport()">
                                <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6 mb-6">
                                    <div class="flex items-center space-x-3 mb-4">
                                        <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                                            <i class="fas fa-check text-white text-xl"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-semibold text-green-800 dark:text-green-200">Laporan Hari Ini Sudah Dikirim</h3>
                                            <p class="text-green-600 dark:text-green-300">Dikirim pada: <span x-text="formatDateTime(getTodayReport().timestamp)"></span></p>
                                        </div>
                                    </div>
                                    
                                    <button @click="showEditReport = true" 
                                            class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors">
                                        <i class="fas fa-edit mr-2"></i>Edit Laporan
                                    </button>
                                </div>
                            </template>

                            <!-- Report Form -->
                            <template x-if="!getTodayReport() || showEditReport">
                                <div class="space-y-6">
                                    <div x-show="showEditReport" class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4">
                                        <p class="text-yellow-800 dark:text-yellow-200">
                                            <i class="fas fa-exclamation-triangle mr-2"></i>
                                            Mode edit: Anda akan mengubah laporan yang sudah ada
                                        </p>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                                            <i class="fas fa-cog mr-2"></i>Apa yang sedang dikerjakan hari ini?
                                        </label>
                                        <textarea x-model="reportForm.workingOn"
                                                  class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none"
                                                  rows="4"
                                                  placeholder="Jelaskan pekerjaan atau tugas yang sedang Anda kerjakan hari ini..."></textarea>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                                            <i class="fas fa-check-circle mr-2"></i>Apa yang sudah diselesaikan hari ini?
                                        </label>
                                        <textarea x-model="reportForm.completed"
                                                  class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none"
                                                  rows="4"
                                                  placeholder="Jelaskan pekerjaan atau tugas yang sudah Anda selesaikan hari ini..."></textarea>
                                    </div>

                                    <div class="flex space-x-3">
                                        <button @click="submitDailyReport()" 
                                                :disabled="!reportForm.workingOn.trim() || !reportForm.completed.trim() || isSubmitting"
                                                :class="!reportForm.workingOn.trim() || !reportForm.completed.trim() || isSubmitting ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                                                class="flex-1 bg-gradient-to-r from-primary-500 to-blue-600 text-white py-3 px-6 rounded-lg font-semibold transition-all duration-200">
                                            <span x-show="!isSubmitting">
                                                <i class="fas fa-paper-plane mr-2"></i>
                                                <span x-text="showEditReport ? 'Update Laporan' : 'Kirim Laporan'"></span>
                                            </span>
                                            <span x-show="isSubmitting" class="flex items-center justify-center">
                                                <div class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"></div>
                                                <span x-text="showEditReport ? 'Mengupdate...' : 'Mengirim...'"></span>
                                            </span>
                                        </button>
                                        
                                        <template x-if="showEditReport">
                                            <button @click="cancelEditReport()" 
                                                    class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors">
                                                <i class="fas fa-times mr-2"></i>Batal
                                            </button>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- Report History -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-history mr-2 text-primary-500"></i>Riwayat Laporan
                            </h3>
                            
                            <div class="space-y-4">
                                <template x-for="report in getMyReports().slice(0, 5)" :key="report.date">
                                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <h4 class="font-semibold text-gray-900 dark:text-white" x-text="formatDate(report.date)"></h4>
                                            <span class="text-sm text-gray-500 dark:text-gray-400" x-text="formatDateTime(report.timestamp)"></span>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Sedang dikerjakan:</h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-400" x-text="report.workingOn"></p>
                                            </div>
                                            <div>
                                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Sudah diselesaikan:</h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-400" x-text="report.completed"></p>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                                
                                <!-- Empty State -->
                                <template x-if="getMyReports().length === 0">
                                    <div class="text-center py-8">
                                        <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <i class="fas fa-file-alt text-2xl text-gray-400"></i>
                                        </div>
                                        <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Belum Ada Laporan</h4>
                                        <p class="text-gray-600 dark:text-gray-400">Mulai buat laporan harian pertama Anda.</p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Admin KPI Management -->
                <template x-if="isAdmin && activeTab === 'kpi-management'">
                    <div class="space-y-6">
                        <!-- Add KPI Form -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
                                <i class="fas fa-plus mr-2 text-primary-500"></i>Tambah KPI Baru
                            </h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Judul KPI</label>
                                    <input type="text" 
                                           x-model="kpiForm.title"
                                           class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                           placeholder="Masukkan judul KPI">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Assign ke Pegawai</label>
                                    <select x-model="kpiForm.assignedTo" 
                                            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                        <option value="">-- Pilih Pegawai --</option>
                                        <template x-for="employee in employees.filter(emp => emp.username !== 'admin' && (emp.status || 'active') === 'active')" :key="employee.username">
                                            <option :value="employee.username" x-text="employee.name"></option>
                                        </template>
                                    </select>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Deskripsi KPI</label>
                                    <textarea x-model="kpiForm.description"
                                              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none"
                                              rows="3"
                                              placeholder="Jelaskan detail KPI yang harus dicapai..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Deadline</label>
                                    <input type="date" 
                                           x-model="kpiForm.deadline"
                                           :min="getCurrentDate()"
                                           class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                </div>
                                <div class="flex items-end">
                                    <button @click="addKPI()" 
                                            :disabled="!kpiForm.title || !kpiForm.assignedTo || !kpiForm.deadline"
                                            class="w-full px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                        <i class="fas fa-plus mr-2"></i>Tambah KPI
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- KPI List -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                                    <i class="fas fa-list mr-2 text-primary-500"></i>Daftar KPI
                                </h3>
                                <div class="text-sm text-gray-600 dark:text-gray-400">
                                    Total: <span x-text="kpiData.length"></span> KPI
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <template x-for="kpi in kpiData" :key="kpi.id">
                                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition-shadow">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <div class="flex items-center space-x-3 mb-2">
                                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="kpi.title"></h4>
                                                    <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                          :class="{
                                                              'kpi-completed': kpi.status === 'completed',
                                                              'kpi-in-progress': kpi.status === 'in-progress',
                                                              'kpi-pending': kpi.status === 'pending',
                                                              'kpi-overdue': kpi.status === 'overdue'
                                                          }"
                                                          x-text="getKPIStatusLabel(kpi.status)"></span>
                                                </div>
                                                <p class="text-gray-600 dark:text-gray-400 mb-3" x-text="kpi.description"></p>
                                                <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                                                    <div>
                                                        <i class="fas fa-user mr-1"></i>
                                                        <span x-text="getEmployeeName(kpi.assignedTo)"></span>
                                                    </div>
                                                    <div>
                                                        <i class="fas fa-calendar mr-1"></i>
                                                        Deadline: <span x-text="formatDate(kpi.deadline)"></span>
                                                    </div>
                                                    <div>
                                                        <i class="fas fa-clock mr-1"></i>
                                                        Dibuat: <span x-text="formatDate(kpi.createdAt)"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="ml-4 flex space-x-2">
                                                <button @click="editKPI(kpi)" 
                                                        class="px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button @click="deleteKPI(kpi.id)" 
                                                        class="px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                                
                                <!-- Empty State -->
                                <template x-if="kpiData.length === 0">
                                    <div class="text-center py-12">
                                        <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <i class="fas fa-tasks text-2xl text-gray-400"></i>
                                        </div>
                                        <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Belum Ada KPI</h4>
                                        <p class="text-gray-600 dark:text-gray-400">Mulai buat KPI pertama untuk tim Anda.</p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Admin Daily Reports View -->
                <template x-if="isAdmin && activeTab === 'daily-reports'">
                    <div class="space-y-6">
                        <!-- Date Filter -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                                    <i class="fas fa-clipboard-list mr-2 text-primary-500"></i>Laporan Harian Pegawai
                                </h3>
                                <div class="flex items-center space-x-4">
                                    <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Tanggal:</label>
                                    <input type="date" 
                                           x-model="selectedReportDate"
                                           :max="getCurrentDate()"
                                           class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                </div>
                            </div>
                        </div>

                        <!-- Reports Display -->
                        <div class="space-y-6">
                            <template x-for="employee in employees.filter(emp => emp.username !== 'admin' && (emp.status || 'active') === 'active')" :key="employee.username">
                                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-primary-500 text-white rounded-full flex items-center justify-center font-semibold"
                                                 x-text="employee.name.charAt(0).toUpperCase()"></div>
                                            <div>
                                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="employee.name"></h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400" x-text="formatDate(selectedReportDate)"></p>
                                            </div>
                                        </div>
                                        <div>
                                            <template x-if="getEmployeeReport(employee.username, selectedReportDate)">
                                                <span class="px-3 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded-full text-sm font-medium">
                                                    <i class="fas fa-check mr-1"></i>Laporan Dikirim
                                                </span>
                                            </template>
                                            <template x-if="!getEmployeeReport(employee.username, selectedReportDate)">
                                                <span class="px-3 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded-full text-sm font-medium">
                                                    <i class="fas fa-times mr-1"></i>Belum Kirim
                                                </span>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <template x-if="getEmployeeReport(employee.username, selectedReportDate)">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div>
                                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                    <i class="fas fa-cog mr-1"></i>Sedang dikerjakan:
                                                </h5>
                                                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300" x-text="getEmployeeReport(employee.username, selectedReportDate).workingOn"></p>
                                                </div>
                                            </div>
                                            <div>
                                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                    <i class="fas fa-check-circle mr-1"></i>Sudah diselesaikan:
                                                </h5>
                                                <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3">
                                                    <p class="text-sm text-gray-700 dark:text-gray-300" x-text="getEmployeeReport(employee.username, selectedReportDate).completed"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    
                                    <template x-if="!getEmployeeReport(employee.username, selectedReportDate)">
                                        <div class="text-center py-8">
                                            <div class="w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                                                <i class="fas fa-file-alt text-xl text-gray-400"></i>
                                            </div>
                                            <p class="text-gray-600 dark:text-gray-400">Belum ada laporan untuk tanggal ini</p>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>

                <!-- Admin KPI Recap -->
                <template x-if="isAdmin && activeTab === 'kpi-recap'">
                    <div class="space-y-6">
                        <!-- KPI Summary Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100 text-sm font-medium">KPI Selesai</p>
                                        <p class="text-3xl font-bold" x-text="getKPIStats().completed"></p>
                                    </div>
                                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-check text-xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm font-medium">Sedang Dikerjakan</p>
                                        <p class="text-3xl font-bold" x-text="getKPIStats().inProgress"></p>
                                    </div>
                                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-play text-xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-yellow-100 text-sm font-medium">Pending</p>
                                        <p class="text-3xl font-bold" x-text="getKPIStats().pending"></p>
                                    </div>
                                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-clock text-xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-red-100 text-sm font-medium">Terlambat</p>
                                        <p class="text-3xl font-bold" x-text="getKPIStats().overdue"></p>
                                    </div>
                                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-exclamation-triangle text-xl"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Employee KPI Progress -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden">
                            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Progress KPI per Pegawai</h4>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pegawai</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total KPI</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Selesai</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Dikerjakan</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pending</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Terlambat</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Progress</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <template x-for="employee in employees.filter(emp => emp.username !== 'admin' && (emp.status || 'active') === 'active')" :key="employee.username">
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="w-8 h-8 bg-primary-500 text-white rounded-full flex items-center justify-center font-semibold text-sm mr-3"
                                                             x-text="employee.name.charAt(0).toUpperCase()"></div>
                                                        <span class="font-medium text-gray-900 dark:text-white" x-text="employee.name"></span>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeKPIStats(employee.username).total"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeKPIStats(employee.username).completed"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeKPIStats(employee.username).inProgress"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeKPIStats(employee.username).pending"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeKPIStats(employee.username).overdue"></td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-2">
                                                            <div class="bg-gradient-to-r from-primary-500 to-blue-600 h-2 rounded-full transition-all duration-500"
                                                                 :style="`width: ${getEmployeeKPIProgress(employee.username)}%`"></div>
                                                        </div>
                                                        <span class="text-sm font-medium text-gray-900 dark:text-white" x-text="getEmployeeKPIProgress(employee.username) + '%'"></span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Admin Attendance Recap -->
                <template x-if="isAdmin && activeTab === 'attendance-recap'">
                    <div class="space-y-6">
                        <!-- Month/Year Filter -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                                    <i class="fas fa-user-clock mr-2 text-primary-500"></i>Rekap Absensi Pegawai
                                </h3>
                                <div class="flex items-center space-x-4">
                                    <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Bulan:</label>
                                    <select x-model="selectedAttendanceMonth" 
                                            class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                        <template x-for="month in getAvailableMonths()" :key="month.value">
                                            <option :value="month.value" x-text="month.label"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Attendance Summary Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                            <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100 text-sm font-medium">Tepat Waktu</p>
                                        <p class="text-3xl font-bold" x-text="getAttendanceStats().onTime"></p>
                                    </div>
                                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-check-circle text-xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-orange-100 text-sm font-medium">Terlambat</p>
                                        <p class="text-3xl font-bold" x-text="getAttendanceStats().late"></p>
                                    </div>
                                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-clock text-xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-purple-100 text-sm font-medium">Tugas Luar</p>
                                        <p class="text-3xl font-bold" x-text="getAttendanceStats().fieldDuty"></p>
                                    </div>
                                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-road text-xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-yellow-100 text-sm font-medium">Sakit</p>
                                        <p class="text-3xl font-bold" x-text="getAttendanceStats().sick"></p>
                                    </div>
                                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-thermometer-half text-xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm font-medium">Izin</p>
                                        <p class="text-3xl font-bold" x-text="getAttendanceStats().permit"></p>
                                    </div>
                                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-hand-paper text-xl"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Employee Attendance Table -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden">
                            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Rekap Absensi per Pegawai</h4>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pegawai</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Hadir</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tepat Waktu</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Terlambat</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tugas Luar</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Sakit</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Izin</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Kehadiran %</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <template x-for="employee in employees.filter(emp => emp.username !== 'admin' && (emp.status || 'active') === 'active')" :key="employee.username">
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="w-8 h-8 bg-primary-500 text-white rounded-full flex items-center justify-center font-semibold text-sm mr-3"
                                                             x-text="employee.name.charAt(0).toUpperCase()"></div>
                                                        <span class="font-medium text-gray-900 dark:text-white" x-text="employee.name"></span>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeAttendanceStats(employee.username).total"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeAttendanceStats(employee.username).onTime"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeAttendanceStats(employee.username).late"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeAttendanceStats(employee.username).fieldDuty"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeAttendanceStats(employee.username).sick"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="getEmployeeAttendanceStats(employee.username).permit"></td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-2">
                                                            <div class="bg-gradient-to-r from-green-500 to-green-600 h-2 rounded-full transition-all duration-500"
                                                                 :style="`width: ${getEmployeeAttendancePercentage(employee.username)}%`"></div>
                                                        </div>
                                                        <span class="text-sm font-medium text-gray-900 dark:text-white" x-text="getEmployeeAttendancePercentage(employee.username) + '%'"></span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Detailed Attendance History -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h4 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Detail Absensi Bulan Ini</h4>
                            
                            <div class="space-y-6">
                                <template x-for="employee in employees.filter(emp => emp.username !== 'admin' && (emp.status || 'active') === 'active')" :key="employee.username">
                                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                        <div class="flex items-center space-x-3 mb-4">
                                            <div class="w-10 h-10 bg-primary-500 text-white rounded-full flex items-center justify-center font-semibold"
                                                 x-text="employee.name.charAt(0).toUpperCase()"></div>
                                            <div>
                                                <h5 class="font-semibold text-gray-900 dark:text-white" x-text="employee.name"></h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-400" x-text="'Absensi bulan ' + getMonthName(selectedAttendanceMonth)"></p>
                                            </div>
                                        </div>
                                        
                                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 gap-2">
                                            <template x-for="attendance in getEmployeeMonthlyAttendance(employee.username)" :key="attendance.date">
                                                <div class="p-2 rounded border border-gray-200 dark:border-gray-600 text-center">
                                                    <div class="text-xs font-medium text-gray-600 dark:text-gray-400" x-text="formatDay(attendance.date)"></div>
                                                    <div class="mt-1">
                                                        <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                              :class="{
                                                                  'att-on-time': attendance.status === 'on-time',
                                                                  'att-late': attendance.status === 'late',
                                                                  'att-field-duty': attendance.status === 'field-duty',
                                                                  'att-sick': attendance.status === 'sick',
                                                                  'att-permit': attendance.status === 'permit',
                                                                  'bg-gray-100 text-gray-400 dark:bg-gray-700': !attendance.status
                                                              }"
                                                              x-text="attendance.status ? getAttendanceStatusShort(attendance.status) : '-'"></span>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Admin Monthly Report -->
                <template x-if="isAdmin && activeTab === 'monthly-report'">
                    <div class="space-y-6">
                        <!-- Filter Controls -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                                    <i class="fas fa-file-export mr-2 text-primary-500"></i>Laporan Bulanan Per Pegawai
                                </h3>
                                
                                <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
                                    <div class="flex items-center space-x-2">
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Pegawai:</label>
                                        <select x-model="selectedEmployee" 
                                                class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                            <option value="">-- Pilih Pegawai --</option>
                                            <template x-for="employee in employees.filter(emp => emp.username !== 'admin' && (emp.status || 'active') === 'active')" :key="employee.username">
                                                <option :value="employee.username" x-text="employee.name"></option>
                                            </template>
                                        </select>
                                    </div>
                                    
                                    <div class="flex items-center space-x-2">
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Bulan:</label>
                                        <select x-model="selectedReportMonth" 
                                                class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                            <template x-for="month in getAvailableMonths()" :key="month.value">
                                                <option :value="month.value" x-text="month.label"></option>
                                            </template>
                                        </select>
                                    </div>
                                    
                                    <template x-if="selectedEmployee">
                                        <button @click="exportMonthlyReport()" 
                                                class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors flex items-center space-x-2">
                                            <i class="fas fa-download"></i>
                                            <span>Export CSV</span>
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Report Content -->
                        <template x-if="selectedEmployee">
                            <div class="space-y-6">
                                <!-- Employee Header -->
                                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-16 h-16 bg-primary-500 text-white rounded-full flex items-center justify-center font-bold text-xl"
                                             x-text="getEmployeeName(selectedEmployee).charAt(0).toUpperCase()"></div>
                                        <div>
                                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white" x-text="getEmployeeName(selectedEmployee)"></h2>
                                            <p class="text-gray-600 dark:text-gray-400" x-text="'Laporan Bulan ' + getMonthName(selectedReportMonth)"></p>
                                        </div>
                                    </div>
                                </div>

                                <!-- KPI Report Section -->
                                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                                        <i class="fas fa-bullseye mr-2 text-blue-500"></i>Laporan KPI
                                    </h3>
                                    
                                    <template x-if="getEmployeeMonthlyKPIs(selectedEmployee).length > 0">
                                        <div class="space-y-4">
                                            <template x-for="kpi in getEmployeeMonthlyKPIs(selectedEmployee)" :key="kpi.id">
                                                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                                    <div class="flex items-start justify-between mb-2">
                                                        <h4 class="font-semibold text-gray-900 dark:text-white" x-text="kpi.title"></h4>
                                                        <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                              :class="{
                                                                  'kpi-completed': kpi.status === 'completed',
                                                                  'kpi-in-progress': kpi.status === 'in-progress',
                                                                  'kpi-pending': kpi.status === 'pending',
                                                                  'kpi-overdue': kpi.status === 'overdue'
                                                              }"
                                                              x-text="getKPIStatusLabel(kpi.status)"></span>
                                                    </div>
                                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2" x-text="kpi.description"></p>
                                                    <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                                                        <span>Dibuat: <span x-text="formatDate(kpi.createdAt)"></span></span>
                                                        <span>Deadline: <span x-text="formatDate(kpi.deadline)"></span></span>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                    
                                    <template x-if="getEmployeeMonthlyKPIs(selectedEmployee).length === 0">
                                        <div class="text-center py-8">
                                            <div class="w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                                                <i class="fas fa-tasks text-xl text-gray-400"></i>
                                            </div>
                                            <p class="text-gray-600 dark:text-gray-400">Tidak ada KPI untuk bulan ini</p>
                                        </div>
                                    </template>
                                </div>

                                <!-- Daily Reports Section -->
                                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                                        <i class="fas fa-clipboard-list mr-2 text-green-500"></i>Laporan Harian
                                    </h3>
                                    
                                    <template x-if="getEmployeeMonthlyReports(selectedEmployee).length > 0">
                                        <div class="space-y-4">
                                            <template x-for="report in getEmployeeMonthlyReports(selectedEmployee)" :key="report.date">
                                                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                                    <div class="flex items-center justify-between mb-3">
                                                        <h4 class="font-semibold text-gray-900 dark:text-white" x-text="formatDate(report.date)"></h4>
                                                        <span class="text-xs text-gray-500 dark:text-gray-400" x-text="formatDateTime(report.timestamp)"></span>
                                                    </div>
                                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        <div>
                                                            <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Sedang dikerjakan:</h5>
                                                            <p class="text-sm text-gray-600 dark:text-gray-400 bg-blue-50 dark:bg-blue-900/20 rounded p-2" x-text="report.workingOn"></p>
                                                        </div>
                                                        <div>
                                                            <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Sudah diselesaikan:</h5>
                                                            <p class="text-sm text-gray-600 dark:text-gray-400 bg-green-50 dark:bg-green-900/20 rounded p-2" x-text="report.completed"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                    
                                    <template x-if="getEmployeeMonthlyReports(selectedEmployee).length === 0">
                                        <div class="text-center py-8">
                                            <div class="w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                                                <i class="fas fa-file-alt text-xl text-gray-400"></i>
                                            </div>
                                            <p class="text-gray-600 dark:text-gray-400">Tidak ada laporan harian untuk bulan ini</p>
                                        </div>
                                    </template>
                                </div>

                                <!-- Attendance Report Section -->
                                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                                        <i class="fas fa-user-clock mr-2 text-orange-500"></i>Laporan Absensi
                                    </h3>
                                    
                                    <!-- Attendance Summary -->
                                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                                        <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-center">
                                            <div class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="getEmployeeAttendanceStats(selectedEmployee).onTime"></div>
                                            <div class="text-sm text-green-600 dark:text-green-400">Tepat Waktu</div>
                                        </div>
                                        <div class="bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 text-center">
                                            <div class="text-2xl font-bold text-orange-600 dark:text-orange-400" x-text="getEmployeeAttendanceStats(selectedEmployee).late"></div>
                                            <div class="text-sm text-orange-600 dark:text-orange-400">Terlambat</div>
                                        </div>
                                        <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 text-center">
                                            <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" x-text="getEmployeeAttendanceStats(selectedEmployee).fieldDuty"></div>
                                            <div class="text-sm text-purple-600 dark:text-purple-400">Tugas Luar</div>
                                        </div>
                                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 text-center">
                                            <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400" x-text="getEmployeeAttendanceStats(selectedEmployee).sick"></div>
                                            <div class="text-sm text-yellow-600 dark:text-yellow-400">Sakit</div>
                                        </div>
                                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 text-center">
                                            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" x-text="getEmployeeAttendanceStats(selectedEmployee).permit"></div>
                                            <div class="text-sm text-blue-600 dark:text-blue-400">Izin</div>
                                        </div>
                                    </div>

                                    <!-- Attendance Details -->
                                    <template x-if="getEmployeeMonthlyAttendanceDetails(selectedEmployee).length > 0">
                                        <div class="space-y-2">
                                            <template x-for="attendance in getEmployeeMonthlyAttendanceDetails(selectedEmployee)" :key="attendance.date">
                                                <div class="flex items-center justify-between py-2 px-3 border border-gray-200 dark:border-gray-700 rounded">
                                                    <span class="font-medium text-gray-900 dark:text-white" x-text="formatDate(attendance.date)"></span>
                                                    <div class="flex items-center space-x-3">
                                                        <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                              :class="{
                                                                  'att-on-time': attendance.status === 'on-time',
                                                                  'att-late': attendance.status === 'late',
                                                                  'att-field-duty': attendance.status === 'field-duty',
                                                                  'att-sick': attendance.status === 'sick',
                                                                  'att-permit': attendance.status === 'permit'
                                                              }"
                                                              x-text="getAttendanceStatusLabel(attendance.status)"></span>
                                                        <span class="text-xs text-gray-500 dark:text-gray-400" x-text="formatDateTime(attendance.timestamp)"></span>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                    
                                    <template x-if="getEmployeeMonthlyAttendanceDetails(selectedEmployee).length === 0">
                                        <div class="text-center py-8">
                                            <div class="w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                                                <i class="fas fa-user-clock text-xl text-gray-400"></i>
                                            </div>
                                            <p class="text-gray-600 dark:text-gray-400">Tidak ada data absensi untuk bulan ini</p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- Empty State -->
                        <template x-if="!selectedEmployee">
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-12 text-center">
                                <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-user-plus text-2xl text-gray-400"></i>
                                </div>
                                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Pilih Pegawai</h3>
                                <p class="text-gray-600 dark:text-gray-400">Pilih pegawai dari dropdown di atas untuk melihat laporan bulanan lengkap</p>
                            </div>
                        </template>
                    </div>
                </template>

            </div>
        </div>
    </div>

    <!-- Auto-save indicator -->
    <div x-show="autoSaving" 
         class="fixed bottom-4 left-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg">
        <i class="fas fa-sync-alt animate-spin mr-2"></i>
        Menyimpan...
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_CONFIG = {
            url: 'https://jsejopgubnzxdntoyuhv.supabase.co', // Ganti dengan URL Supabase Anda
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzZWpvcGd1Ym56eGRudG95dWh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2Mzg5OTEsImV4cCI6MjA2ODIxNDk5MX0.H0OR07aWhRSqBFW9yttkfrzdAYPLCZBYlOuZUjCXp84', // Ganti dengan Anon Key Supabase Anda
        };

        function kpiApp() {
            return {
                // Supabase
                supabase: null,
                supabaseConnected: false,
                isSyncing: false,

                // State variables
                loading: true,
                isLoggedIn: false,
                isAdmin: false,
                currentUser: null,
                credentials: { username: '', password: '' },
                showPassword: false,
                isLoggingIn: false,
                darkMode: false,
                isSubmitting: false,
                autoSaving: false,
                
                // UI state
                activeTab: 'my-kpi',
                notifications: [],
                showEditReport: false,
                showEmployeeModal: false,
                editingEmployee: null,
                showEmployeePassword: false,
                
                // Data
                employees: [
                    { 
                        id: 'admin-1',
                        username: 'admin', 
                        password: 'admin123', 
                        name: 'Administrator',
                        email: 'admin@ibnukatsir.com',
                        position: 'Administrator',
                        status: 'active',
                        created_at: '2025-01-01'
                    },
                    { 
                        id: 'emp-1',
                        username: 'yuni', 
                        password: 'yuni123', 
                        name: 'Yunita Damayanti',
                        email: 'yuni@ibnukatsir.com',
                        position: 'Sales Manager',
                        status: 'active',
                        created_at: '2025-01-01'
                    },
                    { 
                        id: 'emp-2',
                        username: 'qushay', 
                        password: 'qushay123', 
                        name: 'Akhmad Qushayri',
                        email: 'qushay@ibnukatsir.com',
                        position: 'IT Developer',
                        status: 'active',
                        created_at: '2025-01-01'
                    },
                    { 
                        id: 'emp-3',
                        username: 'rendy', 
                        password: 'rendy123', 
                        name: 'Rendy Febrian',
                        email: 'rendy@ibnukatsir.com',
                        position: 'Customer Service',
                        status: 'active',
                        created_at: '2025-01-01'
                    },
                    { 
                        id: 'emp-4',
                        username: 'isma', 
                        password: 'isma123', 
                        name: 'Isma Alfian',
                        email: 'isma@ibnukatsir.com',
                        position: 'Marketing',
                        status: 'active',
                        created_at: '2025-01-01'
                    },
                    { 
                        id: 'emp-5',
                        username: 'mamduh', 
                        password: 'mamduh123', 
                        name: 'Mamduh Nuruddin',
                        email: 'mamduh@ibnukatsir.com',
                        position: 'Finance',
                        status: 'active',
                        created_at: '2025-01-01'
                    }
                ],
                
                kpiData: [],
                dailyReports: {},
                attendanceData: {},
                
                // Forms
                kpiForm: {
                    title: '',
                    description: '',
                    assignedTo: '',
                    deadline: ''
                },
                
                reportForm: {
                    workingOn: '',
                    completed: ''
                },

                attendanceForm: {
                    status: '',
                    description: ''
                },

                employeeForm: {
                    name: '',
                    username: '',
                    email: '',
                    password: '',
                    position: '',
                    status: 'active'
                },
                
                selectedReportDate: '',
                selectedAttendanceMonth: '',
                selectedEmployee: '',
                selectedReportMonth: '',
                
                // Time
                currentTime: '',
                
                // Initialize
                async init() {
                    await this.initSupabase();
                    this.loadFromStorage();
                    this.setupTime();
                    this.selectedReportDate = this.getCurrentDate();
                    this.selectedAttendanceMonth = this.getCurrentYearMonth();
                    this.selectedReportMonth = this.getCurrentYearMonth();
                    
                    // Initialize with some sample data
                    if (this.kpiData.length === 0) {
                        this.initializeSampleKPIs();
                    }
                    
                    // Initialize sample attendance data for testing
                    if (Object.keys(this.attendanceData).length === 0) {
                        this.initializeSampleAttendance();
                    }
                    
                    // Set default active tab based on user type
                    if (!this.isLoggedIn) {
                        this.activeTab = this.isAdmin ? 'employee-management' : 'my-kpi';
                    }
                    
                    // Simulate loading
                    setTimeout(() => {
                        this.loading = false;
                    }, 1500);
                    
                    // Auto-save interval
                    setInterval(() => {
                        this.saveToStorage();
                    }, 10000);
                    
                    // Backup data setiap 5 menit
                    setInterval(() => {
                        this.backupToSessionStorage();
                    }, 300000);
                },

                async initSupabase() {
                    try {
                        if (SUPABASE_CONFIG.url && SUPABASE_CONFIG.key && 
                            SUPABASE_CONFIG.url !== 'YOUR_SUPABASE_URL' && 
                            SUPABASE_CONFIG.key !== 'YOUR_SUPABASE_ANON_KEY') {
                            
                            this.supabase = supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
                            
                            // Test connection
                            const { data, error } = await this.supabase.from('employees').select('count').limit(1);
                            
                            if (!error) {
                                this.supabaseConnected = true;
                                console.log('Supabase connected successfully');
                            } else {
                                console.warn('Supabase connection failed:', error.message);
                            }
                        } else {
                            console.log('Supabase not configured, using local storage');
                        }
                    } catch (error) {
                        console.warn('Supabase initialization failed:', error);
                    }
                },

                async syncToSupabase() {
                    if (!this.supabaseConnected || this.isSyncing) return;
                    
                    this.isSyncing = true;
                    
                    try {
                        // Sync employees
                        for (const employee of this.employees) {
                            if (employee.username !== 'admin') {
                                const { error } = await this.supabase
                                    .from('employees')
                                    .upsert({
                                        id: employee.id,
                                        username: employee.username,
                                        name: employee.name,
                                        email: employee.email,
                                        position: employee.position,
                                        status: employee.status,
                                        created_at: employee.created_at
                                    });
                                
                                if (error) throw error;
                            }
                        }

                        // Sync KPI data
                        for (const kpi of this.kpiData) {
                            const { error } = await this.supabase
                                .from('kpis')
                                .upsert({
                                    id: kpi.id,
                                    title: kpi.title,
                                    description: kpi.description,
                                    assigned_to: kpi.assignedTo,
                                    deadline: kpi.deadline,
                                    status: kpi.status,
                                    created_at: kpi.createdAt,
                                    created_by: kpi.createdBy
                                });
                            
                            if (error) throw error;
                        }

                        // Sync attendance data
                        for (const [username, userAttendance] of Object.entries(this.attendanceData)) {
                            for (const attendance of Object.values(userAttendance)) {
                                const { error } = await this.supabase
                                    .from('attendance')
                                    .upsert({
                                        id: `${username}-${attendance.date}`,
                                        employee_username: username,
                                        date: attendance.date,
                                        status: attendance.status,
                                        description: attendance.description,
                                        timestamp: attendance.timestamp
                                    });
                                
                                if (error) throw error;
                            }
                        }

                        // Sync daily reports
                        for (const [username, userReports] of Object.entries(this.dailyReports)) {
                            for (const report of Object.values(userReports)) {
                                const { error } = await this.supabase
                                    .from('daily_reports')
                                    .upsert({
                                        id: `${username}-${report.date}`,
                                        employee_username: username,
                                        date: report.date,
                                        working_on: report.workingOn,
                                        completed: report.completed,
                                        timestamp: report.timestamp
                                    });
                                
                                if (error) throw error;
                            }
                        }

                        this.showNotification('Data berhasil disinkronkan ke database!', 'success');
                    } catch (error) {
                        console.error('Sync error:', error);
                        this.showNotification('Gagal sinkronisasi: ' + error.message, 'error');
                    } finally {
                        this.isSyncing = false;
                    }
                },
                
                initializeSampleKPIs() {
                    const sampleKPIs = [
                        {
                            id: 'kpi-1',
                            title: 'Meningkatkan Penjualan Q1',
                            description: 'Target meningkatkan penjualan sebesar 20% di quarter pertama tahun ini',
                            assignedTo: 'yuni',
                            deadline: '2025-03-31',
                            status: 'in-progress',
                            createdAt: '2025-01-01',
                            createdBy: 'admin'
                        },
                        {
                            id: 'kpi-2',
                            title: 'Optimasi Sistem Database',
                            description: 'Melakukan optimasi performa database untuk meningkatkan response time aplikasi',
                            assignedTo: 'qushay',
                            deadline: '2025-02-15',
                            status: 'pending',
                            createdAt: '2025-01-05',
                            createdBy: 'admin'
                        },
                        {
                            id: 'kpi-3',
                            title: 'Training Tim Customer Service',
                            description: 'Menyelenggarakan training untuk meningkatkan kualitas pelayanan customer service',
                            assignedTo: 'rendy',
                            deadline: '2025-01-30',
                            status: 'completed',
                            createdAt: '2025-01-02',
                            createdBy: 'admin'
                        }
                    ];
                    
                    this.kpiData = sampleKPIs;
                    this.updateKPIStatuses();
                },

                initializeSampleAttendance() {
                    // Buat sample data absensi untuk testing
                    const currentDate = new Date();
                    const sampleAttendance = {};
                    
                    // Generate data untuk bulan ini dan bulan lalu
                    ['yuni', 'qushay', 'rendy', 'isma', 'mamduh'].forEach(username => {
                        sampleAttendance[username] = {};
                        
                        // Data bulan lalu
                        const lastMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
                        const daysLastMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0).getDate();
                        
                        for (let day = 1; day <= daysLastMonth; day++) {
                            const date = new Date(lastMonth.getFullYear(), lastMonth.getMonth(), day);
                            const dateStr = date.toISOString().split('T')[0];
                            
                            // Skip weekends
                            if (date.getDay() !== 0 && date.getDay() !== 6) {
                                const statuses = ['on-time', 'on-time', 'on-time', 'late', 'field-duty', 'sick', 'permit'];
                                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                                
                                sampleAttendance[username][dateStr] = {
                                    date: dateStr,
                                    status: randomStatus,
                                    description: randomStatus !== 'on-time' ? `Keterangan ${randomStatus}` : null,
                                    timestamp: new Date(date.getTime() + 8 * 60 * 60 * 1000).toISOString(),
                                    employee: username
                                };
                            }
                        }
                        
                        // Data beberapa hari di bulan ini
                        for (let day = 1; day <= Math.min(currentDate.getDate(), 10); day++) {
                            const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                            const dateStr = date.toISOString().split('T')[0];
                            
                            // Skip weekends dan hari ini
                            if (date.getDay() !== 0 && date.getDay() !== 6 && dateStr !== this.getCurrentDate()) {
                                const statuses = ['on-time', 'on-time', 'late', 'field-duty'];
                                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                                
                                sampleAttendance[username][dateStr] = {
                                    date: dateStr,
                                    status: randomStatus,
                                    description: randomStatus !== 'on-time' ? `Keterangan ${randomStatus}` : null,
                                    timestamp: new Date(date.getTime() + 8 * 60 * 60 * 1000).toISOString(),
                                    employee: username
                                };
                            }
                        }
                    });
                    
                    this.attendanceData = sampleAttendance;
                    this.saveToStorage();
                },
                
                setupTime() {
                    this.updateCurrentTime();
                    setInterval(() => {
                        this.updateCurrentTime();
                    }, 1000);
                },
                
                updateCurrentTime() {
                    const jakarta = this.getJakartaDate();
                    this.currentTime = jakarta.toLocaleString('id-ID', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                },
                
                getJakartaDate() {
                    const now = new Date();
                    const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                    return new Date(utc + (7 * 3600000)); // UTC+7
                },
                
                getCurrentDate() {
                    const jakarta = this.getJakartaDate();
                    return jakarta.toISOString().split('T')[0];
                },

                getCurrentYearMonth() {
                    const jakarta = this.getJakartaDate();
                    return jakarta.toISOString().substring(0, 7); // YYYY-MM
                },
                
                getCurrentDateString() {
                    const jakarta = this.getJakartaDate();
                    return jakarta.toLocaleDateString('id-ID', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                },
                
                formatDate(dateString) {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('id-ID', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                },

                formatDay(dateString) {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('id-ID', {
                        day: 'numeric',
                        month: 'short'
                    });
                },
                
                formatDateTime(isoString) {
                    const date = new Date(isoString);
                    return date.toLocaleString('id-ID', {
                        weekday: 'short',
                        day: 'numeric',
                        month: 'short',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },

                // Employee Management Functions
                openEmployeeModal() {
                    this.editingEmployee = null;
                    this.employeeForm = {
                        name: '',
                        username: '',
                        email: '',
                        password: '',
                        position: '',
                        status: 'active'
                    };
                    this.showEmployeePassword = false;
                    this.showEmployeeModal = true;
                },

                editEmployee(employee) {
                    this.editingEmployee = employee;
                    this.employeeForm = {
                        name: employee.name,
                        username: employee.username,
                        email: employee.email || '',
                        password: '',
                        position: employee.position || '',
                        status: employee.status || 'active'
                    };
                    this.showEmployeePassword = false;
                    this.showEmployeeModal = true;
                },

                closeEmployeeModal() {
                    this.showEmployeeModal = false;
                    this.editingEmployee = null;
                    this.employeeForm = {
                        name: '',
                        username: '',
                        email: '',
                        password: '',
                        position: '',
                        status: 'active'
                    };
                },

                isEmployeeFormValid() {
                    const form = this.employeeForm;
                    if (!form.name.trim() || !form.username.trim() || !form.email.trim()) {
                        return false;
                    }
                    
                    // Validasi email
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(form.email)) {
                        return false;
                    }

                    // Untuk user baru, password wajib diisi
                    if (!this.editingEmployee && !form.password.trim()) {
                        return false;
                    }

                    // Check username uniqueness
                    if (!this.editingEmployee) {
                        const existingUser = this.employees.find(emp => emp.username === form.username.trim());
                        if (existingUser) {
                            return false;
                        }
                    }

                    return true;
                },

                async saveEmployee() {
                    if (!this.isEmployeeFormValid()) {
                        this.showNotification('Lengkapi form dengan benar', 'error');
                        return;
                    }

                    this.isSubmitting = true;

                    try {
                        // Simulate save delay
                        await new Promise(resolve => setTimeout(resolve, 1000));

                        const form = this.employeeForm;
                        
                        if (this.editingEmployee) {
                            // Update existing employee
                            const index = this.employees.findIndex(emp => emp.username === this.editingEmployee.username);
                            if (index !== -1) {
                                this.employees[index] = {
                                    ...this.employees[index],
                                    name: form.name.trim(),
                                    email: form.email.trim(),
                                    position: form.position.trim(),
                                    status: form.status
                                };

                                // Update password if provided
                                if (form.password.trim()) {
                                    this.employees[index].password = form.password.trim();
                                }
                            }
                            this.showNotification('Data pegawai berhasil diupdate!', 'success');
                        } else {
                            // Add new employee
                            const newEmployee = {
                                id: 'emp-' + Date.now(),
                                username: form.username.trim(),
                                password: form.password.trim(),
                                name: form.name.trim(),
                                email: form.email.trim(),
                                position: form.position.trim(),
                                status: form.status,
                                created_at: this.getCurrentDate()
                            };
                            
                            this.employees.push(newEmployee);
                            this.showNotification('Pegawai baru berhasil ditambahkan!', 'success');
                        }

                        this.autoSave();
                        this.closeEmployeeModal();
                        
                    } catch (error) {
                        console.error('Error saving employee:', error);
                        this.showNotification('Gagal menyimpan data pegawai', 'error');
                    } finally {
                        this.isSubmitting = false;
                    }
                },

                toggleEmployeeStatus(employee) {
                    const newStatus = (employee.status || 'active') === 'active' ? 'inactive' : 'active';
                    const action = newStatus === 'active' ? 'mengaktifkan' : 'menonaktifkan';
                    
                    if (confirm(`Apakah Anda yakin ingin ${action} pegawai ${employee.name}?`)) {
                        employee.status = newStatus;
                        this.autoSave();
                        this.showNotification(`${employee.name} berhasil ${newStatus === 'active' ? 'diaktifkan' : 'dinonaktifkan'}`, 'success');
                    }
                },

                resetEmployeePassword(employee) {
                    const newPassword = prompt(`Reset password untuk ${employee.name}:`, 'password123');
                    if (newPassword && newPassword.trim()) {
                        employee.password = newPassword.trim();
                        this.autoSave();
                        this.showNotification(`Password ${employee.name} berhasil direset!`, 'success');
                    }
                },

                getActiveEmployeesCount() {
                    return this.employees.filter(emp => emp.username !== 'admin' && (emp.status || 'active') === 'active').length;
                },

                getTodayPresentCount() {
                    const today = this.getCurrentDate();
                    let presentCount = 0;
                    
                    this.employees.filter(emp => emp.username !== 'admin' && (emp.status || 'active') === 'active').forEach(employee => {
                        const attendance = this.attendanceData[employee.username]?.[today];
                        if (attendance && ['on-time', 'late', 'field-duty'].includes(attendance.status)) {
                            presentCount++;
                        }
                    });
                    
                    return presentCount;
                },

                getPendingKPICount() {
                    return this.kpiData.filter(kpi => kpi.status === 'pending').length;
                },
                
                // Authentication
                async login() {
                    // Hash simple untuk password (dalam production gunakan bcrypt atau sejenisnya)
                    const hashPassword = (password) => {
                        // Simple hash - gunakan bcrypt di production
                        return password; // Untuk demo, tidak di-hash
                    };

                    const user = this.employees.find(emp => 
                        emp.username === this.credentials.username && 
                        emp.password === this.credentials.password
                    );
                    
                    if (!user) {
                        this.showNotification('Username atau password salah', 'error');
                        return;
                    }

                    if (user.username !== 'admin' && (user.status || 'active') !== 'active') {
                        this.showNotification('Akun Anda telah dinonaktifkan. Hubungi administrator.', 'error');
                        return;
                    }
                    
                    this.isLoggingIn = true;
                    
                    // Simulate loading
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    this.currentUser = user;
                    this.isAdmin = user.username === 'admin';
                    this.isLoggedIn = true;
                    this.isLoggingIn = false;
                    
                    // Set default tab
                    this.activeTab = this.isAdmin ? 'employee-management' : 'my-kpi';
                    
                    this.showNotification(
                        this.isAdmin ? 'Login admin berhasil!' : `Selamat datang, ${user.name}!`, 
                        'success'
                    );
                },
                
                logout() {
                    this.isLoggedIn = false;
                    this.isAdmin = false;
                    this.currentUser = null;
                    this.credentials = { username: '', password: '' };
                    this.activeTab = 'my-kpi';
                    this.resetForms();
                    
                    this.showNotification('Anda telah logout', 'info');
                },
                
                // Dark mode
                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                    localStorage.setItem('darkMode', this.darkMode);
                    
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                },
                
                // KPI Management
                addKPI() {
                    if (!this.kpiForm.title || !this.kpiForm.assignedTo || !this.kpiForm.deadline) {
                        this.showNotification('Lengkapi semua field yang diperlukan', 'error');
                        return;
                    }
                    
                    const newKPI = {
                        id: 'kpi-' + Date.now(),
                        title: this.kpiForm.title,
                        description: this.kpiForm.description,
                        assignedTo: this.kpiForm.assignedTo,
                        deadline: this.kpiForm.deadline,
                        status: 'pending',
                        createdAt: this.getCurrentDate(),
                        createdBy: this.currentUser.username
                    };
                    
                    this.kpiData.push(newKPI);
                    this.resetKPIForm();
                    this.autoSave();
                    
                    this.showNotification('KPI berhasil ditambahkan!', 'success');
                },
                
                editKPI(kpi) {
                    // Simple edit - could be expanded with a modal
                    const newTitle = prompt('Edit judul KPI:', kpi.title);
                    if (newTitle && newTitle.trim()) {
                        kpi.title = newTitle.trim();
                        this.autoSave();
                        this.showNotification('KPI berhasil diupdate!', 'success');
                    }
                },
                
                deleteKPI(kpiId) {
                    if (confirm('Apakah Anda yakin ingin menghapus KPI ini?')) {
                        this.kpiData = this.kpiData.filter(kpi => kpi.id !== kpiId);
                        this.autoSave();
                        this.showNotification('KPI berhasil dihapus!', 'success');
                    }
                },
                
                resetKPIForm() {
                    this.kpiForm = {
                        title: '',
                        description: '',
                        assignedTo: '',
                        deadline: ''
                    };
                },
                
                // KPI Status Management
                toggleKPIStatus(kpiId) {
                    const kpi = this.kpiData.find(k => k.id === kpiId);
                    if (!kpi) return;
                    
                    if (kpi.status === 'completed') {
                        kpi.status = 'in-progress';
                        this.showNotification('KPI dikembalikan ke status "Sedang Dikerjakan"', 'info');
                    } else {
                        kpi.status = 'completed';
                        this.showNotification('Selamat! KPI berhasil diselesaikan!', 'success');
                    }
                    
                    this.autoSave();
                },
                
                updateKPIStatuses() {
                    const today = new Date(this.getCurrentDate());
                    
                    this.kpiData.forEach(kpi => {
                        if (kpi.status !== 'completed') {
                            const deadline = new Date(kpi.deadline);
                            if (deadline < today) {
                                kpi.status = 'overdue';
                            } else if (kpi.status === 'pending') {
                                // Keep as pending
                            }
                        }
                    });
                },
                
                getKPIStatusLabel(status) {
                    const labels = {
                        'pending': 'Pending',
                        'in-progress': 'Sedang Dikerjakan',
                        'completed': 'Selesai',
                        'overdue': 'Terlambat'
                    };
                    return labels[status] || 'Unknown';
                },
                
                // Employee KPI functions
                getMyKPIs() {
                    if (!this.currentUser) return [];
                    this.updateKPIStatuses();
                    return this.kpiData.filter(kpi => kpi.assignedTo === this.currentUser.username);
                },
                
                getKPIProgress() {
                    const myKPIs = this.getMyKPIs();
                    if (myKPIs.length === 0) return 0;
                    const completed = myKPIs.filter(kpi => kpi.status === 'completed').length;
                    return Math.round((completed / myKPIs.length) * 100);
                },
                
                getCompletedKPICount() {
                    return this.getMyKPIs().filter(kpi => kpi.status === 'completed').length;
                },

                // Attendance functions
                getTodayAttendance() {
                    if (!this.currentUser) return null;
                    const today = this.getCurrentDate();
                    return this.attendanceData[this.currentUser.username]?.[today] || null;
                },

                getTodayAttendanceStatus() {
                    const attendance = this.getTodayAttendance();
                    return attendance ? this.getAttendanceStatusLabel(attendance.status) : 'Belum Absen';
                },

                getAttendanceStatusLabel(status) {
                    const labels = {
                        'on-time': 'Tepat Waktu',
                        'late': 'Terlambat',
                        'field-duty': 'Tugas Luar',
                        'sick': 'Sakit',
                        'permit': 'Izin'
                    };
                    return labels[status] || 'Unknown';
                },

                getAttendanceStatusShort(status) {
                    const labels = {
                        'on-time': 'H',
                        'late': 'T',
                        'field-duty': 'TL',
                        'sick': 'S',
                        'permit': 'I'
                    };
                    return labels[status] || '-';
                },

                getDescriptionPlaceholder(status) {
                    const placeholders = {
                        'late': 'Jelaskan alasan keterlambatan...',
                        'field-duty': 'Jelaskan detail tugas luar kantor...',
                        'sick': 'Jelaskan kondisi sakit...',
                        'permit': 'Jelaskan keperluan izin...'
                    };
                    return placeholders[status] || '';
                },

                needsDescription() {
                    return ['late', 'field-duty', 'sick', 'permit'].includes(this.attendanceForm.status);
                },

                async submitAttendance() {
                    if (!this.attendanceForm.status) {
                        this.showNotification('Pilih status absensi', 'error');
                        return;
                    }

                    if (this.needsDescription() && !this.attendanceForm.description.trim()) {
                        this.showNotification('Keterangan harus diisi untuk status ini', 'error');
                        return;
                    }
                    
                    this.isSubmitting = true;
                    
                    // Simulate submission
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const today = this.getCurrentDate();
                    const timestamp = new Date().toISOString();
                    
                    if (!this.attendanceData[this.currentUser.username]) {
                        this.attendanceData[this.currentUser.username] = {};
                    }
                    
                    this.attendanceData[this.currentUser.username][today] = {
                        date: today,
                        status: this.attendanceForm.status,
                        description: this.attendanceForm.description.trim() || null,
                        timestamp: timestamp,
                        employee: this.currentUser.username
                    };
                    
                    this.autoSave();
                    this.resetAttendanceForm();
                    this.isSubmitting = false;
                    
                    this.showNotification('Absensi berhasil dicatat!', 'success');
                },

                resetAttendanceForm() {
                    this.attendanceForm = {
                        status: '',
                        description: ''
                    };
                },

                getMyAttendanceHistory() {
                    if (!this.currentUser) return [];
                    const userAttendance = this.attendanceData[this.currentUser.username] || {};
                    return Object.values(userAttendance).sort((a, b) => new Date(b.date) - new Date(a.date));
                },

                // Office Status Functions
                getEmployeeTodayAttendance(username) {
                    const today = this.getCurrentDate();
                    return this.attendanceData[username]?.[today] || null;
                },

                getTodayOfficeStats() {
                    const today = this.getCurrentDate();
                    const stats = { present: 0, fieldDuty: 0, sick: 0, permit: 0 };
                    
                    this.employees.filter(emp => emp.username !== 'admin' && (emp.status || 'active') === 'active').forEach(employee => {
                        const attendance = this.attendanceData[employee.username]?.[today];
                        if (attendance) {
                            switch (attendance.status) {
                                case 'on-time':
                                case 'late':
                                    stats.present++;
                                    break;
                                case 'field-duty':
                                    stats.fieldDuty++;
                                    break;
                                case 'sick':
                                    stats.sick++;
                                    break;
                                case 'permit':
                                    stats.permit++;
                                    break;
                            }
                        }
                    });
                    
                    return stats;
                },
                
                // Daily Report functions
                getTodayReport() {
                    if (!this.currentUser) return null;
                    const today = this.getCurrentDate();
                    return this.dailyReports[this.currentUser.username]?.[today] || null;
                },
                
                async submitDailyReport() {
                    if (!this.reportForm.workingOn.trim() || !this.reportForm.completed.trim()) {
                        this.showNotification('Lengkapi semua field laporan', 'error');
                        return;
                    }
                    
                    this.isSubmitting = true;
                    
                    // Simulate submission
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const today = this.getCurrentDate();
                    const timestamp = new Date().toISOString();
                    
                    if (!this.dailyReports[this.currentUser.username]) {
                        this.dailyReports[this.currentUser.username] = {};
                    }
                    
                    this.dailyReports[this.currentUser.username][today] = {
                        date: today,
                        workingOn: this.reportForm.workingOn.trim(),
                        completed: this.reportForm.completed.trim(),
                        timestamp: timestamp,
                        employee: this.currentUser.username
                    };
                    
                    this.autoSave();
                    this.resetReportForm();
                    this.isSubmitting = false;
                    
                    this.showNotification(
                        this.showEditReport ? 'Laporan berhasil diupdate!' : 'Laporan berhasil dikirim!', 
                        'success'
                    );
                    
                    this.showEditReport = false;
                },
                
                resetReportForm() {
                    this.reportForm = {
                        workingOn: '',
                        completed: ''
                    };
                },
                
                cancelEditReport() {
                    this.showEditReport = false;
                    this.resetReportForm();
                },
                
                getMyReports() {
                    if (!this.currentUser) return [];
                    const userReports = this.dailyReports[this.currentUser.username] || {};
                    return Object.values(userReports).sort((a, b) => new Date(b.date) - new Date(a.date));
                },
                
                // Admin report functions
                getEmployeeReport(username, date) {
                    return this.dailyReports[username]?.[date] || null;
                },
                
                getEmployeeName(username) {
                    const employee = this.employees.find(emp => emp.username === username);
                    return employee ? employee.name : username;
                },

                // Admin attendance functions
                getAvailableMonths() {
                    const months = [];
                    const currentDate = new Date(this.getCurrentDate());
                    
                    // Show last 12 months
                    for (let i = 0; i < 12; i++) {
                        const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                        const value = date.toISOString().substring(0, 7);
                        const label = date.toLocaleDateString('id-ID', { year: 'numeric', month: 'long' });
                        months.push({ value, label });
                    }
                    
                    return months;
                },

                getMonthName(yearMonth) {
                    const [year, month] = yearMonth.split('-');
                    const date = new Date(year, month - 1, 1);
                    return date.toLocaleDateString('id-ID', { year: 'numeric', month: 'long' });
                },

                getAttendanceStats() {
                    const stats = { onTime: 0, late: 0, fieldDuty: 0, sick: 0, permit: 0 };
                    
                    Object.values(this.attendanceData).forEach(userAttendance => {
                        Object.values(userAttendance).forEach(attendance => {
                            if (attendance.date.startsWith(this.selectedAttendanceMonth)) {
                                switch (attendance.status) {
                                    case 'on-time': stats.onTime++; break;
                                    case 'late': stats.late++; break;
                                    case 'field-duty': stats.fieldDuty++; break;
                                    case 'sick': stats.sick++; break;
                                    case 'permit': stats.permit++; break;
                                }
                            }
                        });
                    });
                    
                    return stats;
                },

                getEmployeeAttendanceStats(username) {
                    const stats = { total: 0, onTime: 0, late: 0, fieldDuty: 0, sick: 0, permit: 0 };
                    const userAttendance = this.attendanceData[username] || {};
                    
                    // Use selectedReportMonth if we're in monthly report tab, otherwise use selectedAttendanceMonth
                    const monthToUse = this.activeTab === 'monthly-report' ? this.selectedReportMonth : this.selectedAttendanceMonth;
                    
                    Object.values(userAttendance).forEach(attendance => {
                        if (attendance.date.startsWith(monthToUse)) {
                            stats.total++;
                            switch (attendance.status) {
                                case 'on-time': stats.onTime++; break;
                                case 'late': stats.late++; break;
                                case 'field-duty': stats.fieldDuty++; break;
                                case 'sick': stats.sick++; break;
                                case 'permit': stats.permit++; break;
                            }
                        }
                    });
                    
                    return stats;
                },

                getEmployeeAttendancePercentage(username) {
                    const stats = this.getEmployeeAttendanceStats(username);
                    const workingDays = stats.onTime + stats.late + stats.fieldDuty; // Count field duty as working
                    
                    // Use selectedReportMonth if we're in monthly report tab, otherwise use selectedAttendanceMonth
                    const monthToUse = this.activeTab === 'monthly-report' ? this.selectedReportMonth : this.selectedAttendanceMonth;
                    const totalPossibleDays = this.getWorkingDaysInMonth(monthToUse);
                    
                    if (totalPossibleDays === 0) return 0;
                    return Math.round((workingDays / totalPossibleDays) * 100);
                },

                getWorkingDaysInMonth(month = null) {
                    const monthToUse = month || this.selectedAttendanceMonth;
                    const [year, monthNum] = monthToUse.split('-');
                    const startDate = new Date(year, monthNum - 1, 1);
                    const endDate = new Date(year, monthNum, 0);
                    
                    let workingDays = 0;
                    
                    for (let date = new Date(startDate); date <= endDate; date.setDate(date.getDate() + 1)) {
                        // Skip Sabtu (6) dan Minggu (0)
                        if (date.getDay() !== 0 && date.getDay() !== 6) {
                            workingDays++;
                        }
                    }
                    
                    return workingDays;
                },

                getEmployeeMonthlyAttendance(username) {
                    const userAttendance = this.attendanceData[username] || {};
                    const monthlyAttendance = [];
                    
                    // Get all days in the selected month
                    const [year, month] = this.selectedAttendanceMonth.split('-');
                    const daysInMonth = new Date(year, month, 0).getDate();
                    
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dateStr = `${year}-${month.padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                        const attendance = userAttendance[dateStr];
                        
                        monthlyAttendance.push({
                            date: dateStr,
                            status: attendance?.status || null,
                            description: attendance?.description || null
                        });
                    }
                    
                    return monthlyAttendance;
                },
                
                // Admin KPI stats
                getKPIStats() {
                    const stats = {
                        completed: 0,
                        inProgress: 0,
                        pending: 0,
                        overdue: 0
                    };
                    
                    this.updateKPIStatuses();
                    
                    this.kpiData.forEach(kpi => {
                        switch (kpi.status) {
                            case 'completed':
                                stats.completed++;
                                break;
                            case 'in-progress':
                                stats.inProgress++;
                                break;
                            case 'pending':
                                stats.pending++;
                                break;
                            case 'overdue':
                                stats.overdue++;
                                break;
                        }
                    });
                    
                    return stats;
                },
                
                getEmployeeKPIStats(username) {
                    const employeeKPIs = this.kpiData.filter(kpi => kpi.assignedTo === username);
                    const stats = {
                        total: employeeKPIs.length,
                        completed: 0,
                        inProgress: 0,
                        pending: 0,
                        overdue: 0
                    };
                    
                    employeeKPIs.forEach(kpi => {
                        switch (kpi.status) {
                            case 'completed':
                                stats.completed++;
                                break;
                            case 'in-progress':
                                stats.inProgress++;
                                break;
                            case 'pending':
                                stats.pending++;
                                break;
                            case 'overdue':
                                stats.overdue++;
                                break;
                        }
                    });
                    
                    return stats;
                },
                
                getEmployeeKPIProgress(username) {
                    const stats = this.getEmployeeKPIStats(username);
                    if (stats.total === 0) return 0;
                    return Math.round((stats.completed / stats.total) * 100);
                },

                // Monthly Report Functions
                getEmployeeMonthlyKPIs(username) {
                    if (!username) return [];
                    
                    return this.kpiData.filter(kpi => {
                        if (kpi.assignedTo !== username) return false;
                        
                        // Check if KPI was created in selected month or has deadline in selected month
                        const createdDate = new Date(kpi.createdAt);
                        const deadlineDate = new Date(kpi.deadline);
                        const [year, month] = this.selectedReportMonth.split('-');
                        const monthStart = new Date(year, month - 1, 1);
                        const monthEnd = new Date(year, month, 0);
                        
                        return (createdDate >= monthStart && createdDate <= monthEnd) ||
                               (deadlineDate >= monthStart && deadlineDate <= monthEnd);
                    });
                },

                getEmployeeMonthlyReports(username) {
                    if (!username) return [];
                    
                    const userReports = this.dailyReports[username] || {};
                    return Object.values(userReports)
                        .filter(report => report.date.startsWith(this.selectedReportMonth))
                        .sort((a, b) => new Date(b.date) - new Date(a.date));
                },

                getEmployeeMonthlyAttendanceDetails(username) {
                    if (!username) return [];
                    
                    const userAttendance = this.attendanceData[username] || {};
                    return Object.values(userAttendance)
                        .filter(attendance => attendance.date.startsWith(this.selectedReportMonth))
                        .sort((a, b) => new Date(b.date) - new Date(a.date));
                },

                exportMonthlyReport() {
                    if (!this.selectedEmployee) {
                        this.showNotification('Pilih pegawai terlebih dahulu', 'error');
                        return;
                    }

                    try {
                        const employeeName = this.getEmployeeName(this.selectedEmployee);
                        const monthName = this.getMonthName(this.selectedReportMonth);
                        
                        // Prepare CSV data
                        let csvContent = `Laporan Bulanan - ${employeeName}\n`;
                        csvContent += `Periode: ${monthName}\n`;
                        csvContent += `Tanggal Export: ${this.getCurrentDateString()}\n\n`;

                        // KPI Report
                        csvContent += "=== LAPORAN KPI ===\n";
                        csvContent += "Judul KPI,Status,Deskripsi,Tanggal Dibuat,Deadline\n";
                        
                        const kpis = this.getEmployeeMonthlyKPIs(this.selectedEmployee);
                        if (kpis.length > 0) {
                            kpis.forEach(kpi => {
                                csvContent += `"${kpi.title}","${this.getKPIStatusLabel(kpi.status)}","${kpi.description}","${this.formatDate(kpi.createdAt)}","${this.formatDate(kpi.deadline)}"\n`;
                            });
                        } else {
                            csvContent += "Tidak ada KPI untuk bulan ini\n";
                        }

                        // Daily Reports
                        csvContent += "\n=== LAPORAN HARIAN ===\n";
                        csvContent += "Tanggal,Sedang Dikerjakan,Sudah Diselesaikan,Waktu Submit\n";
                        
                        const reports = this.getEmployeeMonthlyReports(this.selectedEmployee);
                        if (reports.length > 0) {
                            reports.forEach(report => {
                                csvContent += `"${this.formatDate(report.date)}","${report.workingOn}","${report.completed}","${this.formatDateTime(report.timestamp)}"\n`;
                            });
                        } else {
                            csvContent += "Tidak ada laporan harian untuk bulan ini\n";
                        }

                        // Attendance Report
                        csvContent += "\n=== LAPORAN ABSENSI ===\n";
                        
                        const attendanceStats = this.getEmployeeAttendanceStats(this.selectedEmployee);
                        csvContent += "Ringkasan Absensi:\n";
                        csvContent += `Total Hadir,${attendanceStats.total}\n`;
                        csvContent += `Tepat Waktu,${attendanceStats.onTime}\n`;
                        csvContent += `Terlambat,${attendanceStats.late}\n`;
                        csvContent += `Tugas Luar,${attendanceStats.fieldDuty}\n`;
                        csvContent += `Sakit,${attendanceStats.sick}\n`;
                        csvContent += `Izin,${attendanceStats.permit}\n`;
                        csvContent += `Persentase Kehadiran,${this.getEmployeeAttendancePercentage(this.selectedEmployee)}%\n\n`;

                        csvContent += "Detail Absensi:\n";
                        csvContent += "Tanggal,Status,Keterangan,Waktu Absen\n";
                        
                        const attendanceDetails = this.getEmployeeMonthlyAttendanceDetails(this.selectedEmployee);
                        if (attendanceDetails.length > 0) {
                            attendanceDetails.forEach(attendance => {
                                csvContent += `"${this.formatDate(attendance.date)}","${this.getAttendanceStatusLabel(attendance.status)}","${attendance.description || '-'}","${this.formatDateTime(attendance.timestamp)}"\n`;
                            });
                        } else {
                            csvContent += "Tidak ada data absensi untuk bulan ini\n";
                        }

                        // Download CSV
                        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                        const link = document.createElement('a');
                        const url = URL.createObjectURL(blob);
                        link.setAttribute('href', url);
                        link.setAttribute('download', `Laporan_Bulanan_${employeeName}_${this.selectedReportMonth}.csv`);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);

                        this.showNotification('Laporan berhasil diekspor ke CSV!', 'success');
                    } catch (error) {
                        console.error('Error exporting monthly report:', error);
                        this.showNotification('Gagal mengekspor laporan', 'error');
                    }
                },
                
                // Utility functions
                resetForms() {
                    this.resetKPIForm();
                    this.resetReportForm();
                    this.resetAttendanceForm();
                },
                
                // Storage operations
                loadFromStorage() {
                    try {
                        // Load employees with enhanced security
                        const savedEmployees = localStorage.getItem('employees');
                        if (savedEmployees) {
                            const employees = JSON.parse(savedEmployees);
                            // Merge with default admin and ensure data integrity
                            this.employees = employees.filter(emp => emp.username && emp.name);
                            
                            // Ensure admin exists
                            const adminExists = this.employees.find(emp => emp.username === 'admin');
                            if (!adminExists) {
                                this.employees.unshift({
                                    id: 'admin-1',
                                    username: 'admin',
                                    password: 'admin123',
                                    name: 'Administrator',
                                    email: 'admin@ibnukatsir.com',
                                    position: 'Administrator',
                                    status: 'active',
                                    created_at: '2025-01-01'
                                });
                            }
                        }

                        // Load other data
                        const savedKPIs = localStorage.getItem('kpiData');
                        if (savedKPIs) {
                            this.kpiData = JSON.parse(savedKPIs);
                        }
                        
                        const savedReports = localStorage.getItem('dailyReports');
                        if (savedReports) {
                            this.dailyReports = JSON.parse(savedReports);
                        }

                        const savedAttendance = localStorage.getItem('attendanceData');
                        if (savedAttendance) {
                            this.attendanceData = JSON.parse(savedAttendance);
                        }
                        
                        // If localStorage kosong, coba restore dari sessionStorage
                        if (!savedAttendance || Object.keys(JSON.parse(savedAttendance || '{}')).length === 0) {
                            this.restoreFromSessionStorage();
                        }
                        
                        const darkMode = localStorage.getItem('darkMode');
                        if (darkMode !== null) {
                            this.darkMode = darkMode === 'true';
                            if (this.darkMode) {
                                document.documentElement.classList.add('dark');
                            }
                        }
                        
                        console.log('Data loaded from storage:', {
                            employeeCount: this.employees.length,
                            kpiCount: this.kpiData.length,
                            attendanceUsers: Object.keys(this.attendanceData).length,
                            reportUsers: Object.keys(this.dailyReports).length
                        });
                    } catch (error) {
                        console.error('Error loading from storage:', error);
                        this.showNotification('Gagal memuat data tersimpan', 'warning');
                    }
                },
                
                saveToStorage() {
                    try {
                        localStorage.setItem('employees', JSON.stringify(this.employees));
                        localStorage.setItem('kpiData', JSON.stringify(this.kpiData));
                        localStorage.setItem('dailyReports', JSON.stringify(this.dailyReports));
                        localStorage.setItem('attendanceData', JSON.stringify(this.attendanceData));
                        
                        console.log('Data saved to localStorage:', {
                            employeeCount: this.employees.length,
                            kpiCount: this.kpiData.length,
                            attendanceUsers: Object.keys(this.attendanceData).length,
                            reportUsers: Object.keys(this.dailyReports).length
                        });
                    } catch (error) {
                        console.error('Error saving to storage:', error);
                        this.showNotification('Gagal menyimpan data', 'error');
                    }
                },

                backupToSessionStorage() {
                    try {
                        sessionStorage.setItem('employees_backup', JSON.stringify(this.employees));
                        sessionStorage.setItem('kpiData_backup', JSON.stringify(this.kpiData));
                        sessionStorage.setItem('dailyReports_backup', JSON.stringify(this.dailyReports));
                        sessionStorage.setItem('attendanceData_backup', JSON.stringify(this.attendanceData));
                        
                        console.log('Data backed up to sessionStorage');
                    } catch (error) {
                        console.error('Error backing up to sessionStorage:', error);
                    }
                },

                restoreFromSessionStorage() {
                    try {
                        const backupEmployees = sessionStorage.getItem('employees_backup');
                        if (backupEmployees) {
                            this.employees = JSON.parse(backupEmployees);
                        }

                        const backupKPIs = sessionStorage.getItem('kpiData_backup');
                        if (backupKPIs) {
                            this.kpiData = JSON.parse(backupKPIs);
                        }
                        
                        const backupReports = sessionStorage.getItem('dailyReports_backup');
                        if (backupReports) {
                            this.dailyReports = JSON.parse(backupReports);
                        }

                        const backupAttendance = sessionStorage.getItem('attendanceData_backup');
                        if (backupAttendance) {
                            this.attendanceData = JSON.parse(backupAttendance);
                            this.showNotification('Data dipulihkan dari backup', 'info');
                        }
                        
                        console.log('Data restored from sessionStorage backup');
                    } catch (error) {
                        console.error('Error restoring from sessionStorage:', error);
                    }
                },

                exportData() {
                    try {
                        const exportData = {
                            employees: this.employees,
                            kpiData: this.kpiData,
                            dailyReports: this.dailyReports,
                            attendanceData: this.attendanceData,
                            exportDate: new Date().toISOString(),
                            version: '2.0'
                        };
                        
                        const dataStr = JSON.stringify(exportData, null, 2);
                        const dataBlob = new Blob([dataStr], { type: 'application/json' });
                        
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(dataBlob);
                        link.download = `kpi_system_backup_${this.getCurrentDate()}.json`;
                        link.click();
                        
                        this.showNotification('Data berhasil diekspor', 'success');
                    } catch (error) {
                        console.error('Error exporting data:', error);
                        this.showNotification('Gagal mengekspor data', 'error');
                    }
                },

                importData(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            // Validate imported data structure
                            if (!importedData.version || !importedData.exportDate) {
                                throw new Error('Format file tidak valid');
                            }

                            if (importedData.employees) {
                                this.employees = importedData.employees;
                            }
                            if (importedData.kpiData) {
                                this.kpiData = importedData.kpiData;
                            }
                            if (importedData.dailyReports) {
                                this.dailyReports = importedData.dailyReports;
                            }
                            if (importedData.attendanceData) {
                                this.attendanceData = importedData.attendanceData;
                            }
                            
                            this.saveToStorage();
                            this.showNotification('Data berhasil diimpor', 'success');
                        } catch (error) {
                            console.error('Error importing data:', error);
                            this.showNotification('Gagal mengimpor data - format file tidak valid', 'error');
                        }
                    };
                    reader.readAsText(file);
                    
                    // Reset input
                    event.target.value = '';
                },
                
                async autoSave() {
                    this.autoSaving = true;
                    this.saveToStorage();
                    this.backupToSessionStorage();
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    this.autoSaving = false;
                },
                
                // Notifications
                showNotification(message, type = 'info') {
                    const id = Date.now();
                    const notification = {
                        id,
                        message,
                        type,
                        show: true
                    };
                    
                    this.notifications.push(notification);
                    
                    // Auto remove after 5 seconds
                    setTimeout(() => {
                        this.removeNotification(id);
                    }, 5000);
                },
                
                removeNotification(id) {
                    const index = this.notifications.findIndex(n => n.id === id);
                    if (index > -1) {
                        this.notifications[index].show = false;
                        setTimeout(() => {
                            this.notifications.splice(index, 1);
                        }, 300);
                    }
                }
            };
        }
    </script>
</body>
</html>
